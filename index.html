<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- <link rel="icon" href="./assets/favicon.ico"> -->
    <title>Event</title>
    <!-- 字體 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@100..900&display=swap" rel="stylesheet"> 
    
    <!-- 共用樣式 -->
    <link rel="stylesheet" href="./assets/css/style.css">
  </head>
  <body>
    <div class="container">
      <!-- header -->
      <div class="header">  
        <div class="header-logo-container">
          <img src="./assets/images/logo.svg" alt="logo">
        </div>
      <div class="header-line"></div>
    </div>

    <!-- Cookie 同意區塊 -->
    <div class="cookie-consent" id="cookieConsent" style="display: none;">
      <div class="cookie-content">
        <p class="cookie-text">
          為提升您的使用體驗，本網站使用 Cookies 分析技術。繼續使用即表示您同意本網站的 Cookies 政策。更多 Cookies 資訊，請參閱本網站的<a href="privacy.html" class="cookie-link">隱私權政策</a>。
        </p>
        <div class="cookie-buttons">
          <button class="cookie-button cookie-button-accept" onclick="handleCookieAccept()">我接受</button>
        </div>
      </div>
    </div>

    <!-- 請先同意 Cookie 彈窗 -->
    <div class="popup-overlay" id="cookieWarningPopup" style="display: none;">
      <div class="popup-content">
        <h2 class="popup-title">提醒</h2>
        <div class="popup-content-box">
          <p class="popup-message">請先同意 Cookie 政策以繼續使用本網站功能。</p>
        </div>
        <button class="popup-button" onclick="closeCookieWarningPopup()">OK</button>
      </div>
    </div>

    <!-- loading -->
    <main class="main" id="loadingScreen">
      <div class="loading-container">
        <span class="loading-text">LOADING...</span>
        <div class="progress-container">
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
          </div>
        </div>
      </div>
    </main>

    <!-- content -->
    <main class="main" id="mainContent" style="display: none;">
        <div class="usage-title">集章活動</div>
        <div class="org-line"></div>
        <div class="usage-content">
          <div class="usage-content-title">
            歡迎來到統一證券攤位<br>
            完成以下步驟即可獲得<span>扭蛋機抽獎機會乙次</span>
          </div>

          <!-- 步驟 -->
          <div class="content-step-list">
            <div class="step-item">
              <div class="step-number">
                <div>Step1</div>
              </div>
              <div class="step-text">完成攤位體驗掃描QRcode</div>
            </div>
            <div class="step-item">
              <div class="step-number">
                <div>Step2</div>
              </div>
              <div class="step-text">掃描完成後，前往下一關卡</div>
            </div>
            <div class="step-item">
              <div class="step-number">
                <div>Step3</div>
              </div>
              <div class="step-text">集滿4個K棒，完成收集活動</div>
            </div>
            <div class="step-item">
              <div class="step-number">
                <div>Step4</div>
              </div>
              <div class="step-text">憑兌換畫面至服務台領取獎品</div>
            </div>
          </div>

          <!-- 備註 -->
          <div class="content-ps">
            <div class="ps-title">備註</div>
            <div>
              <p>1. 每支行動裝置只能體驗一次</p>
              <p>2. 請確認下方流程，確保最佳體驗：</p>
              <ul>
                <li>以Chrome瀏覽器開啟</li>
                <li>點選同意開啟鏡頭權限</li>
              </ul>
            </div>
          </div>
        </div>
        <button class="common-button back-button" onclick="handleStartCollection()">開始蒐集</button>
      </main>

      <!-- footer -->
      <div class="footer-line">
        © 統一綜合證券股份有限公司 114年金管證總字第0041號
      </div>
    </div>

    <script>
      // 顯示主要內容
      function showMainContent() {
        const loadingScreen = document.getElementById('loadingScreen');
        const mainContent = document.getElementById('mainContent');
        
        if (loadingScreen && mainContent) {
          loadingScreen.style.display = 'none';
          mainContent.style.display = 'flex';
        }
      }

      // 進度條動畫控制
      function animateProgress() {
        const progressFill = document.getElementById('progressFill');
        let progress = 0;
        
        const interval = setInterval(() => {
          progress += Math.random() * 15 + 5; // 隨機增加 5-20%
          
          if (progress >= 100) {
            progress = 100;
            clearInterval(interval);
            // 添加完成動畫效果
            if (progressFill) {
              progressFill.classList.add('completed');
            }
          }
          
          // 更新進度條寬度
          if (progressFill) {
            progressFill.style.width = progress + '%';
          }
        }, 150); // 每150ms更新一次
        
        return interval;
      }

      // Cookie 同意相關函數
      function showCookieConsent() {
        // 檢查是否已經同意過 cookie
        const cookieConsent = localStorage.getItem('cookieConsent');

        // todo: 為方便測試，先不檢查 cookie 同意狀態
        // if (!cookieConsent) {
          const cookieConsentBar = document.getElementById('cookieConsent');
          if (cookieConsentBar) {
            // 先設置 display
            cookieConsentBar.style.display = 'block';
            document.body.classList.add('has-cookie-consent');
            
            // 等待一帧后再添加動畫類，確保初始狀態被渲染
            requestAnimationFrame(() => {
              setTimeout(() => {
                cookieConsentBar.classList.add('showing');
              }, 10);
            });
          }
        // }
      }

      function handleCookieAccept() {
        // 保存同意狀態
        localStorage.setItem('cookieConsent', 'accepted');
        hideCookieConsent();
      }


      function hideCookieConsent() {
        const cookieConsentBar = document.getElementById('cookieConsent');
        if (cookieConsentBar) {
          // 移除 showing 類，添加 hiding 類觸發動畫
          cookieConsentBar.classList.remove('showing');
          cookieConsentBar.classList.add('hiding');
          
          // 等待動畫完成後隱藏元素
          setTimeout(() => {
            cookieConsentBar.style.display = 'none';
            cookieConsentBar.classList.remove('hiding');
            document.body.classList.remove('has-cookie-consent');
          }, 400); // 與 CSS 中的 transition 時間一致
        }
      }

      // 檢查 Cookie 同意狀態
      function checkCookieConsent() {
        const cookieConsent = localStorage.getItem('cookieConsent');
        return cookieConsent === 'accepted';
      }

      // 顯示 Cookie 警告彈窗
      function showCookieWarningPopup() {
        const popup = document.getElementById('cookieWarningPopup');
        if (popup) {
          popup.style.display = 'flex';
          document.body.style.overflow = 'hidden';
        }
      }

      // 關閉 Cookie 警告彈窗
      function closeCookieWarningPopup() {
        const popup = document.getElementById('cookieWarningPopup');
        if (popup) {
          popup.style.display = 'none';
          document.body.style.overflow = 'auto';
        }
      }

      // 點擊背景關閉彈窗
      document.addEventListener('click', (e) => {
        const popup = document.getElementById('cookieWarningPopup');
        if (e.target === popup) {
          closeCookieWarningPopup();
        }
      });

      // ESC 鍵關閉彈窗
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          const popup = document.getElementById('cookieWarningPopup');
          if (popup && popup.style.display === 'flex') {
            closeCookieWarningPopup();
          }
        }
      });

      // 處理開始蒐集按鈕點擊
      function handleStartCollection() {
        if (checkCookieConsent()) {
          window.location.href = 'event.html';
        } else {
          showCookieWarningPopup();
        }
      }

      // 頁面載入完成後初始化
      document.addEventListener('DOMContentLoaded', function() {
        // todo: 為方便測試，初始先設定cookie不同意
        localStorage.setItem('cookieConsent', 'disagreed');

        // 開始進度條動畫
        const progressInterval = animateProgress();
        
        // 3秒後顯示主要內容
        setTimeout(() => {
          // 確保進度條到達100%
          const progressFill = document.getElementById('progressFill');
          
          if (progressFill) {
            progressFill.style.width = '100%';
          }
          
          // 清除進度動畫
          clearInterval(progressInterval);
          
          // 短暫延遲後切換到主要內容
          setTimeout(() => {
            showMainContent();
            showCookieConsent();
          }, 300);
        }, 3000);
      });
    </script>
  </body>
</html>
<style>
  
  .main{
   padding: 16px 24px;
   display: flex;
   gap: 16px;
   flex-direction: column;
   justify-content: center;
   align-items: center;
  }
  .usage-title{
    font-size: 28px;
    font-weight: 700;
    text-align: center;
    color: #DC5511;
  }
  .org-line{
    width: 38px;
    height: 4px;
    background: linear-gradient(90deg, #F9A61A 31.25%, #F37721 63.94%, #EC3023 100%);

  }
  .usage-content{
    color: #2E2928;
    font-size: 16px;
    text-align: left;
    flex: 1;
    overflow-y: auto;
    overflow-x: hidden;
    max-height: calc(100vh - 257px);
    padding-right: 8px;
    margin-right: -8px;
    padding-top: 8px;
    width: 100%;
  }
  .usage-content-title{
    border: 1px solid #2E2928;
    padding: 4px;
    border-radius: 4px;
    color: #2E2928;
    font-size: 16px;
    font-weight: 500;
    text-align: center;
    margin-bottom: 24px;
  }
  .usage-content-title span{
    color: #DF4836;
  }
  
  /* 自定義滾動條樣式 */
  .usage-content::-webkit-scrollbar {
    width: 2px;
  }
  
  .usage-content::-webkit-scrollbar-track {
    background: rgba(16, 73, 93, 0.2);
    border-radius: 3px;
  }
  
  .usage-content::-webkit-scrollbar-thumb {
    background: #374745;
    border-radius: 3px;
  }
  
  .usage-content::-webkit-scrollbar-thumb:hover {
    background: #374745;
  }
  
  .back-button{
    width: 240px;
  }


  .content-step-list{
    display: flex;
    flex-direction: column;
    gap: 8;
    margin-bottom: 24px;
  }
  .content-step-list .step-item{
    display: flex;
    gap: 4px;
    align-items: flex-start;
  }
  .content-step-list .step-item .step-number{
    display: flex;
    align-items: center;
    padding: 2px 4px;
    gap: 4px;
    color: #6E3715;
    font-weight: 700;
    font-size: 18px;
    margin-right: 20px;
  }

  .content-step-list .step-item .step-text{
    font-size: 18px;
    font-weight: 500;
    color: #2E2928;
    flex: 1;
    padding: 1.5px 0;
  }

  .content-ps{
    display: flex;
    gap: 10px;
    align-items: flex-start;
    
  }

  .content-ps .ps-title{
    border: 2px solid #2E2928;
    padding: 0 6px;
    font-size: 14px;
    font-weight: 700;
    color: #2E2928;
    min-width: fit-content;
  }
  .content-ps p {
    line-height: 1.5;
    margin-bottom: 0;
    font-size: 16px;
    color: #2E2928;
  }
  .content-ps ul {
    margin: 10px 0;
    color: #2E2928;
    line-height: 1.8;
  }



</style>